[1mdiff --git a/amplify.yml b/amplify.yml[m
[1mindex 20e41f9..3639db7 100644[m
[1m--- a/amplify.yml[m
[1m+++ b/amplify.yml[m
[36m@@ -13,6 +13,8 @@[m [mfrontend:[m
         - npm ci                              # [KEEP][m
         - npm config set fund false           # [ADD] å¯„ä»˜å•ã„åˆã‚ã›ã‚’æŠ‘æ­¢[m
         - npm config set audit false          # [ADD] ç›£æŸ»ã‚’æŠ‘æ­¢ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çŸ­ç¸®[m
[32m+[m[32m        - npm --prefix packages/shared run build || true[m[41m[m
[32m+[m[32m        - npm --prefix packages/backend-core run build || true[m[41m[m
         # ç’°å¢ƒå¤‰æ•°ã‚’æ˜ç¤ºçš„ã« .env.production ã«æ›¸ãå‡ºã™ï¼ˆå¿…è¦ãªã‚‚ã®ã ã‘ï¼‰[KEEP][m
         - echo "AUTOSNSFLOW_ACCESS_KEY_ID=$AUTOSNSFLOW_ACCESS_KEY_ID" >> .env.production[m
         - echo "AUTOSNSFLOW_SECRET_ACCESS_KEY=$AUTOSNSFLOW_SECRET_ACCESS_KEY" >> .env.production[m
[36m@@ -22,6 +24,7 @@[m [mfrontend:[m
         # [ADD] ãƒ•ãƒ©ã‚°ãŒã‚ã‚Œã°å³æ™‚æˆåŠŸçµ‚äº†[m
         - if [ -f /tmp/AMPLIFY_SKIP_BUILD ]; then echo "No frontend changes. Skip build."; exit 0; fi[m
         - NEXT_TELEMETRY_DISABLED=1 npm run build   # [MOD] Nextã®ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªç„¡åŠ¹åŒ–ã§ã‚ãšã‹ã«çŸ­ç¸®[m
[32m+[m[32m        - cd frontend && npm ci && npm run build[m[41m[m
   artifacts:[m
     baseDirectory: .next[m
     files:[m
[1mdiff --git a/lambda/scheduled-autosnsflow/package.json b/lambda/scheduled-autosnsflow/package.json[m
[1mindex dc47f81..eb3ee07 100644[m
[1m--- a/lambda/scheduled-autosnsflow/package.json[m
[1m+++ b/lambda/scheduled-autosnsflow/package.json[m
[36m@@ -11,7 +11,9 @@[m
   },[m
   "dependencies": {[m
     "@autosnsflow/backend-core": "file:../../packages/backend-core",[m
[31m-    "@autosnsflow/shared": "file:../../packages/shared"[m
[32m+[m[32m    "@autosnsflow/shared": "file:../../packages/shared",[m[41m[m
[32m+[m[32m    "@aws-sdk/client-dynamodb": "^3.0.0",[m[41m[m
[32m+[m[32m    "@aws-sdk/util-dynamodb": "^3.0.0"[m[41m[m
   },[m
   "devDependencies": {[m
     "@types/node": "^20.19.11",[m
[1mdiff --git a/lambda/scheduled-autosnsflow/src/handler.ts b/lambda/scheduled-autosnsflow/src/handler.ts[m
[1mindex c17c5ee..6ddc6e3 100644[m
[1m--- a/lambda/scheduled-autosnsflow/src/handler.ts[m
[1m+++ b/lambda/scheduled-autosnsflow/src/handler.ts[m
[36m@@ -1,28 +1,1743 @@[m
 // /lambda/scheduled-autosnsflow/src/handler.ts[m
[31m-// æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®æœ€å°å‹•ä½œï¼šThreadsã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ã‚’Discordã¸é€šçŸ¥[m
[31m-import { fetchDiscordWebhooks } from "@autosnsflow/backend-core";[m
[32m+[m[32m// å®šæœŸå®Ÿè¡Œã§äºˆç´„æŠ•ç¨¿ã®ä½œæˆãƒ»å®ŸæŠ•ç¨¿ãƒ»è¿”ä¿¡å‡¦ç†ãƒ»2æ®µéšæŠ•ç¨¿ã‚’è¡Œã„ã€å¿…è¦ãªé€šçŸ¥ã¨è¨ˆæ¸¬ã‚’è¡Œã†ã€‚[m[41m[m
[32m+[m[32m// æœ¬å®Ÿè£…ã¯ Threads ã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹ï¼ˆX/Twitter ã¯æ‰±ã‚ãªã„ï¼‰ã€‚[m[41m[m
[32m+[m[41m[m
 import { fetchThreadsAccounts } from "@autosnsflow/backend-core";[m
[31m-import { postDiscord } from "@autosnsflow/backend-core";[m
[32m+[m[32mimport {[m[41m[m
[32m+[m[32m  DynamoDBClient,[m[41m[m
[32m+[m[32m  QueryCommand,[m[41m[m
[32m+[m[32m  GetItemCommand,[m[41m[m
[32m+[m[32m  PutItemCommand,[m[41m[m
[32m+[m[32m  UpdateItemCommand,[m[41m[m
[32m+[m[32m  ScanCommand,[m[41m[m
[32m+[m[32m  DescribeTableCommand,[m[41m[m
[32m+[m[32m  DeleteItemCommand,[m[41m[m
[32m+[m[32m} from "@aws-sdk/client-dynamodb";[m[41m[m
[32m+[m[32mimport crypto from "crypto";[m[41m[m
[32m+[m[32mimport { unmarshall } from "@aws-sdk/util-dynamodb";[m[41m[m
[32m+[m[41m[m
[32m+[m[32m/// === ãƒ†ãƒ¼ãƒ–ãƒ«å ===[m[41m[m
[32m+[m[32mconst TBL_SETTINGS   = "UserSettings";[m[41m[m
[32m+[m[32mconst TBL_THREADS    = "ThreadsAccounts";[m[41m[m
[32m+[m[32mconst TBL_SCHEDULED  = "ScheduledPosts";[m[41m[m
[32m+[m[32mconst TBL_REPLIES    = "Replies";[m[41m[m
[32m+[m[32mconst TBL_GROUPS     = "AutoPostGroups";[m[41m[m
[32m+[m[32mconst TBL_LOGS       = "ExecutionLogs";[m[41m[m
[32m+[m[32mconst TBL_USAGE      = "UsageCounters";[m[41m[m
[32m+[m[41m[m
[32m+[m[32m// æ—¢å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆå˜ä½“ãƒ†ã‚¹ãƒˆç”¨ï¼‰[m[41m[m
[32m+[m[32mconst USER_ID = "c7e43ae8-0031-70c5-a8ec-0f7962ee250f";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst region = process.env.AWS_REGION || "ap-northeast-1";[m[41m[m
[32m+[m[32mconst ddb = new DynamoDBClient({ region });[m[41m[m
[32m+[m[41m[m
[32m+[m[32m/// ========== å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ==========[m[41m[m
[32m+[m[32mconst TZ = "Asia/Tokyo";[m[41m[m
[32m+[m[32mconst nowSec = () => Math.floor(Date.now() / 1000);[m[41m[m
[32m+[m[32mconst toEpochSec = (d: any) => Math.floor(d.getTime() / 1000);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m// JST(UTC+9)ã®å›ºå®šã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆDSTãªã—ï¼‰[m[41m[m
[32m+[m[32mconst JST_OFFSET_MIN = 9 * 60;[m[41m[m
[32m+[m[32mconst MS_PER_MIN = 60 * 1000;[m[41m[m
[32m+[m[32mconst MS_PER_DAY = 24 * 60 * 60 * 1000;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m// ä¸ãˆãŸæ™‚åˆ»(ms)ã®ã€ŒJSTã®ä¸€æ—¥ã®é–‹å§‹/çµ‚äº†ã€ã®UTCã‚¨ãƒãƒƒã‚¯ã‚’è¿”ã™[m[41m[m
[32m+[m[32mconst epochStartOfJstDayMs = (ms: any) => {[m[41m[m
[32m+[m[32m  const o = JST_OFFSET_MIN * MS_PER_MIN;[m[41m[m
[32m+[m[32m  return Math.floor((ms + o) / MS_PER_DAY) * MS_PER_DAY - o;[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst epochEndOfJstDayMs = (ms: any) => epochStartOfJstDayMs(ms) + MS_PER_DAY - 1;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m// ç¾åœ¨æ™‚åˆ»ï¼ˆDateï¼‰[m[41m[m
[32m+[m[32mconst jstNow = () => new Date(Date.now());[m[41m[m
[32m+[m[41m[m
[32m+[m[32m// JSTã®0:00/23:59:59.999[m[41m[m
[32m+[m[32mconst startOfDayJst = (d: any) => new Date(epochStartOfJstDayMs(d.getTime()));[m[41m[m
[32m+[m[32mconst endOfDayJst   = (d: any) => new Date(epochEndOfJstDayMs(d.getTime()));[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst TABLE  = process.env.SCHEDULED_POSTS_TABLE || "ScheduledPosts";[m[41m[m
[32m+[m[41m[m
[32m+[m[32m/// ========== GSIå ==========[m[41m[m
[32m+[m[32mconst GSI_SCH_BY_ACC_TIME = "GSI1"; // ScheduledPosts: accountId, scheduledAt[m[41m[m
[32m+[m[32mconst GSI_POS_BY_ACC_TIME = "GSI2"; // ScheduledPosts: accountId, postedAt[m[41m[m
[32m+[m[32mconst GSI_REPLIES_BY_ACC  = "GSI1"; // Replies: accountId, createdAt[m[41m[m
[32m+[m[41m[m
[32m+[m[32m/// ========== OpenAI æ—¢å®šå€¤ & ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ ==========[m[41m[m
[32m+[m[32mconst DEFAULT_OPENAI_MODEL = "gpt-3.5-turbo";[m[41m[m
[32m+[m[32mconst DEFAULT_OPENAI_TEMP = 0.7;[m[41m[m
[32m+[m[32mconst DEFAULT_OPENAI_MAXTOKENS = 300;[m[41m[m
[32m+[m[41m[m
[32m+[m[32mfunction isGsiMissing(err: any) {[m[41m[m
[32m+[m[32m  const msg = String(err?.message || err || "");[m[41m[m
[32m+[m[32m  return err?.name === "ValidationException" && /specified index/i.test(msg);[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[41m[m
[32m+[m[32mfunction buildMasterPrompt(theme: any, displayName: any) {[m[41m[m
[32m+[m[32m  return `ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒã§SNSæŠ•ç¨¿æ–‡ï¼ˆ140å­—å‰å¾Œãƒ»çµµæ–‡å­—ã¯æ§ãˆã‚ãƒ»ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãªã—ï¼‰ã‚’1æœ¬ã€æ—¥æœ¬èªã§ä½œæˆã—ã¦ãã ã•ã„ã€‚[m[41m[m
[32m+[m[32m- ãƒ†ãƒ¼ãƒ: ${theme}[m[41m[m
[32m+[m[32m- èªã‚Šå£: èª­ã¿æ‰‹ã«å¯„ã‚Šæ·»ã†è‡ªç„¶ãªä¸€äººç§°[m[41m[m
[32m+[m[32m- å®Ÿåã‚„å›ºæœ‰åè©ã¯å‡ºã•ãªã„[m[41m[m
[32m+[m[32m- æ”¹è¡Œã¯2å›ã¾ã§[m[41m[m
[32m+[m[32mï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆå: ${displayName || "N/A"}ï¼‰`;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[41m[m
[32m+[m[32masync function callOpenAIText({ apiKey, model, temperature, max_tokens, prompt }: any) {[m[41m[m
[32m+[m[32m  const body = {[m[41m[m
[32m+[m[32m    model,[m[41m[m
[32m+[m[32m    messages: [{ role: "user", content: prompt }],[m[41m[m
[32m+[m[32m    temperature,[m[41m[m
[32m+[m[32m    max_tokens,[m[41m[m
[32m+[m[32m  };[m[41m[m
[32m+[m[32m  const resp